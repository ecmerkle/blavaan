<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prior Predictive Checks • blavaan</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prior Predictive Checks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blavaan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5-5.1296</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-basics" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Basics</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-basics">
<li><a class="dropdown-item" href="../articles/start.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/prior.html">Prior Specification</a></li>
    <li><a class="dropdown-item" href="../articles/estimate.html">Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/convergence_efficiency.html">Convergence and Efficiency Evaluation</a></li>
    <li><a class="dropdown-item" href="../articles/summaries.html">Model Summaries</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">Plots</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples/Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples-details">
<li><a class="dropdown-item" href="../articles/ordinal.html">Estimation with Ordinal Data</a></li>
    <li><a class="dropdown-item" href="../articles/multilevel.html">Two-level Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/invariance.html">Measurement Invariance</a></li>
    <li><a class="dropdown-item" href="../articles/approx_fi.html">Approximate Fit Indices</a></li>
    <li><a class="dropdown-item" href="../articles/model_comparison.html">Model Comparison</a></li>
    <li><a class="dropdown-item" href="../articles/cross_loadings_strong_priors.html">Cross-loadings with Strong Priors</a></li>
    <li><a class="dropdown-item" href="../articles/mod_indices.html">Modification Indices</a></li>
    <li><a class="dropdown-item" href="../articles/prior_pred_checks.html">Prior Predictive Checks</a></li>
    <li><a class="dropdown-item" href="../articles/convergence_loop.html">Convergence Loop</a></li>
    <li><a class="dropdown-item" href="../articles/probability_direction.html">Probability of Direction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/resources.html">Resources</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ecmerkle/blavaan"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://groups.google.com/d/forum/blavaan"><span class="fa fa-users"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Prior Predictive Checks</h1>
                        <h4 data-toc-skip class="author">Mauricio
Garnier-Villarreal</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ecmerkle/blavaan/blob/master/vignettes/prior_pred_checks.Rmd" class="external-link"><code>vignettes/prior_pred_checks.Rmd</code></a></small>
      <div class="d-none name"><code>prior_pred_checks.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>In Bayesian models we need to specify priors for the model
parameters. Priors are the distribution that we <em>think</em> the
parameters would follow, even before having data. These can represent
<strong>high</strong> or <strong>low</strong> uncertainty, so that a
<em>diffuse</em> prior indicates that we don not know a lot about how
the parameter would behave, while an <em>informative</em> prior means
that we are quite certain about the expected distribution.</p>
</div>
<div class="section level3">
<h3 id="prior-predictive-checks">Prior Predictive Checks<a class="anchor" aria-label="anchor" href="#prior-predictive-checks"></a>
</h3>
<p>Prior predictive checks (PPC) generate data according to the prior in
order to asses whether a prior is appropriate <span class="citation">(Gabry et al. 2019)</span>. A posterior predictive
check generates replicated data according to the posterior predictive
distribution. In contrast, the prior predictive check generates data
according to the prior predictive distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y^{sim} ∼ p(y)</annotation></semantics></math>.</p>
<p>The prior predictive distribution is just like the posterior
predictive distribution with no observed data, so that a prior
predictive check is nothing more than the limiting case of a posterior
predictive check with no data.</p>
<p>This is easy to carry out mechanically by simulating parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">θ^{sim}∼p(\theta)</annotation></semantics></math>
according to the priors, then simulating data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>∣</mo><msup><mi>θ</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y^{sim}∼p(y∣ \theta^{sim})</annotation></semantics></math>
according to the sampling distribution given the simulated parameters.
The result is a simulation from the joint distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>y</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo>,</mo><msup><mi>θ</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(y^{sim},θ^{sim})∼p(y,\theta)</annotation></semantics></math>
and thus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow></msup><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y^{sim}∼p(y)</annotation></semantics></math>
is a simulation from the prior predictive distribution.</p>
<p>In <em>blavaan</em> we can get PPC when we use the argument
<code>prisamp=TRUE</code> , this will tell blavaan to ignore the data
and build distributions only from the priors. Here we will start by
adjusting the priors, instead of using the default priors.</p>
<div class="section level4">
<h4 id="weakly-informative-priors">Weakly informative priors<a class="anchor" aria-label="anchor" href="#weakly-informative-priors"></a>
</h4>
<p>We will show an example with the <span class="citation">Holzinger and
Swineford (1939)</span> data, first a case with weakly informative
priors. Here we are stpecifying that the observeded variable intercepts
will have a prior of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(3, 2)</annotation></semantics></math>,
the factor loadings will have a prior of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.4</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0.4, 2)</annotation></semantics></math>,
and the residual standard deviation with a prior of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Gamma(1,1)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dpriors.html">dpriors</a></span><span class="op">(</span>nu<span class="op">=</span><span class="st">"normal(3,2)"</span>,</span>
<span>                  lambda<span class="op">=</span><span class="st">"normal(0.4, 2)"</span>,</span>
<span>                  theta<span class="op">=</span><span class="st">"gamma(1,1)[sd]"</span><span class="op">)</span></span></code></pre></div>
<p>Then we estimate the BSEM model with the respective priors on the
<code>dp</code> argument, and with <code>prisamp=TRUE</code>, so getting
PPC instead of posterior distributions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HS.model</span> <span class="op">&lt;-</span> <span class="st">' visual  =~ x1 + x2 + x3</span></span>
<span><span class="st">              textual =~ x4 + x5 + x6</span></span>
<span><span class="st">              speed   =~ x7 + x8 + x9 '</span></span>
<span></span>
<span><span class="va">fit_wi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcfa.html">bcfa</a></span><span class="op">(</span><span class="va">HS.model</span>, data<span class="op">=</span><span class="va">HolzingerSwineford1939</span>, </span>
<span>            std.lv<span class="op">=</span><span class="cn">TRUE</span>, meanstructure<span class="op">=</span><span class="cn">T</span>, test <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>            dp<span class="op">=</span><span class="va">priors</span>, prisamp <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>You might get some warning messages from either divergent and/or
failed convergence. For this we would ignore these messages as it is
likely to have issues for the evaluations of prior predictions.</p>
<p>We now have a <strong>blavaan</strong> object with prior predictive
distributions, so we can use any of the package functions to describe
them, and see if the parameters are within expected ranges. For example
we can get the PPC density distributions for the first 9 parameters
(factor loadings in this case). The basic <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method
calls the functions from the <code>bayesplot</code> package <span class="citation">(Gabry and Mahr 2021)</span> and with the
<code>plot.type = "dens"</code> argument we can plot the density
distributions</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_wi</span>, pars<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, plot.type <span class="op">=</span> <span class="st">"dens"</span><span class="op">)</span></span></code></pre></div>
<p><img src="prior_pred_checks_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>You can also pick which parameters to plot, like the factor
correlations by chossing parameters <code>19:21</code> in this case</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_wi</span>, pars<span class="op">=</span><span class="fl">19</span><span class="op">:</span><span class="fl">21</span>, plot.type <span class="op">=</span> <span class="st">"dens"</span><span class="op">)</span></span></code></pre></div>
<p><img src="prior_pred_checks_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>From the factor loading distributions we see that the first loading
on each factor is bounded by 0, this is due to a modeling identification
constraint in blavaan, and with a maximum value around 6. And for all
other distributions they range between -6 to 6 or -4 to 4, and for all
priors the most likely value is around 0. This would be described as
weakly informative as it allows negative and positive values but without
allowing crazy high/low values.</p>
<p>What would be a <em>realistic</em> range would depend on the
parameter, model specification, and data. So, consider these priors in
function of those characteristics.</p>
<p>For the factor correlations we kept the default diffuse priors, so
these allowed very high and low correlation, but the prior distributions
are not flat across all possible correlation values.</p>
</div>
<div class="section level4">
<h4 id="default-priors">Default priors<a class="anchor" aria-label="anchor" href="#default-priors"></a>
</h4>
<p>In this next example, we will estimate the PPC with the package
default priors, that would consider diffuse priors. You can see the
blavaan default priors with the function <code><a href="../reference/dpriors.html">dpriors()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dpriors.html">dpriors</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                nu             alpha            lambda              beta </span></span>
<span><span class="co">##    "normal(0,32)"    "normal(0,10)"    "normal(0,10)"    "normal(0,10)" </span></span>
<span><span class="co">##             theta               psi               rho             ibpsi </span></span>
<span><span class="co">## "gamma(1,.5)[sd]" "gamma(1,.5)[sd]"       "beta(1,1)" "wishart(3,iden)" </span></span>
<span><span class="co">##               tau </span></span>
<span><span class="co">##   "normal(0,1.5)"</span></span></code></pre>
<p>Then we estimate the BSEM model and ignore the <code>dp</code>
argument letting run with the default priors, and with
<code>prisamp=TRUE</code>, so getting PPC instead of posterior
distributions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcfa.html">bcfa</a></span><span class="op">(</span><span class="va">HS.model</span>, data<span class="op">=</span><span class="va">HolzingerSwineford1939</span>, </span>
<span>            std.lv<span class="op">=</span><span class="cn">TRUE</span>, meanstructure<span class="op">=</span><span class="cn">T</span>, test <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>            prisamp <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>Then we can plot the density distributions and compare them. We see
that with the default diffuse priors, the model allows up to very high
values such as -30 to 30</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_df</span>, pars<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, plot.type <span class="op">=</span> <span class="st">"dens"</span><span class="op">)</span></span></code></pre></div>
<p><img src="prior_pred_checks_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>This way we can see that the more diffuse priors allows a higher
range of values. It is up to the researcher to decide which range of
priors better present their expectations.</p>
<p>It is important to note that these PPC allows to see the expected
distributions based on the priors, but these might not be the same as
the priors used in the estimation process, as the priors interact with
the model specification and constraints (such as the o bound constraint
for the first factor loading) <span class="citation">(Merkle et al.
2023)</span></p>
</div>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bayesplot" class="csl-entry">
Gabry, Jonah, and Tristan Mahr. 2021. <span>“Bayesplot: Plotting for
Bayesian Models.”</span> <a href="https://mc-stan.org/bayesplot/" class="external-link">https://mc-stan.org/bayesplot/</a>.
</div>
<div id="ref-Gabry_2019_vis" class="csl-entry">
Gabry, Jonah, Daniel Simpson, Aki Vehtari, Michael Betancourt, and
Andrew Gelman. 2019. <span>“<span class="nocase">Visualization in
Bayesian Workflow</span>.”</span> <em>Journal of the Royal Statistical
Society Series A: Statistics in Society</em> 182 (2): 389–402. <a href="https://doi.org/10.1111/rssa.12378" class="external-link">https://doi.org/10.1111/rssa.12378</a>.
</div>
<div id="ref-holswi39" class="csl-entry">
Holzinger, K. J., and F. A. Swineford. 1939. <em>A Study of Factor
Analysis: <span>T</span>he Stability of a Bi-Factor Solution</em>.
Supplementary Educational Monograph 48. Chicago: University of Chicago
Press.
</div>
<div id="ref-merkle2023opaque" class="csl-entry">
Merkle, Edgar C., Oludare Ariyo, Sonja D. Winter, and Mauricio
Garnier-Villarreal. 2023. <span>“Opaque Prior Distributions in Bayesian
Latent Variable Models.”</span> <a href="https://arxiv.org/abs/2301.08667" class="external-link">https://arxiv.org/abs/2301.08667</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edgar Merkle, Yves Rosseel, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
